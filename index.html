<!DOCTYPE html>
  <html lang="pt-BR">
  <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dashboard Usina Solar</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
      :root { --prim:#2c3e50; --sec:#3498db; --succ:#27ae60; --danger:#e74c3c; --warn:#f39c12; }
      * { margin:0;padding:0;box-sizing:border-box; }
      body { font-family:'Inter',sans-serif; background:#f1f5f9; color:#2c3e50; padding:20px; }
      .container { max-width:1700px; margin:0 auto; background:#fff; border-radius:16px; box-shadow:0 20px 50px rgba(0,0,0,0.1); overflow:hidden; }
      .header { background:linear-gradient(135deg,#2c3e50,#34495e); color:white; padding:35px 40px; text-align:center; border-bottom:5px solid #3498db; }
      .header h1 { font-size:2.8rem; font-weight:700; margin-bottom:10px; }
      .header .date { font-size:1.3rem; background:rgba(255,255,255,0.15); padding:10px 25px; border-radius:30px; }
      .kpi { display:grid; grid-template-columns:repeat(auto-fit,minmax(240px,1fr)); gap:25px; padding:30px; }
      .kpicard { background:#fff; padding:25px; border-radius:12px; box-shadow:0 8px 25px rgba(0,0,0,0.1); text-align:center; cursor:pointer; transition:.3s; border-left:6px solid var(--sec); }
      .kpicard:hover { transform:translateY(-10px); }
      .kpicard h2 { font-size:3.2rem; font-weight:800; margin:10px 0; }
      .kpicard p { color:#7f8c8d; font-weight:600; text-transform:uppercase; letter-spacing:1px; }
      .kpicard.atrasadas { border-color:var(--danger); }
      .kpicard.exec { border-color:var(--sec); }
      .kpicard.prox { border-color:var(--warn); }
      .kpicard.conc { border-color:var(--succ); }
      .charts { display:grid; grid-template-columns:1fr 1fr; gap:30px; padding:0 30px 30px; }
      @media (max-width:1100px) { .charts { grid-template-columns:1fr; } }
      canvas { border-radius:12px; box-shadow:0 6px 20px rgba(0,0,0,0.08); }
      .controls { padding:0 30px 20px; display:flex; gap:15px; align-items:center; flex-wrap:wrap; }
      input[type=text] { padding:12px 20px; border:2px solid #ddd; border-radius:50px; width:420px; font-size:1rem; }
      button { padding:12px 25px; background:var(--prim); color:white; border:none; border-radius:50px; cursor:pointer; font-weight:600; }
      .atividades { padding:0 30px 40px; }
      .atividade { background:#fff; padding:22px; margin-bottom:18px; border-radius:12px; box-shadow:0 4px 15px rgba(0,0,0,0.06); cursor:pointer; transition:.3s; border-left:6px solid var(--sec); }
      .atividade:hover { transform:translateY(-5px); box-shadow:0 12px 30px rgba(0,0,0,0.12); }
      .atividade.atrasada { border-left-color:var(--danger); }
      .atividade.exec { border-left-color:var(--sec); }
      .atividade.prox { border-left-color:var(--warn); }
      .atividade.concluida { border-left-color:var(--succ); }
      .atividade-header { display:flex; justify-content:space-between; align-items:center; margin-bottom:12px; }
      .atividade-title { font-size:1.35rem; font-weight:600; }
      .badge { padding:6px 14px; border-radius:50px; font-size:0.85rem; font-weight:600; }
      .progress { height:12px; background:#ecf0f1; border-radius:6px; overflow:hidden; margin:12px 0; position:relative; }
      .progress-bar { height:100%; border-radius:6px; transition:width .6s; }
      .progress-ideal { position:absolute; top:0; width:4px; height:100%; background:#2c3e50; }
      .modal { display:none; position:fixed; z-index:1000; left:0; top:0; width:100%; height:100%; background:rgba(0,0,0,0.7); justify-content:center; align-items:center; }
      .modal-content { background:#fff; padding:30px; border-radius:16px; max-width:800px; width:90%; max-height:90vh; overflow-y:auto; position:relative; }
      .close { position:absolute; top:15px; right:25px; font-size:2.5rem; cursor:pointer; color:#aaa; }
      .close:hover { color:#000; }
      .deps-title { background:#f8f9fa; padding:10px 15px; font-weight:600; border-bottom:1px solid #eee; }
      .dep-item { padding:10px 15px; background:#f8f9fa; border-left:4px solid #3498db; margin:8px 0; border-radius:4px; }
      .dep-item.atrasada { border-left-color:#e74c3c; background:#fef2f2; }
      .dep-item.concluida { border-left-color:#27ae60; background:#f0fdf4; }
      footer { text-align:center; padding:30px; background:#f8f9fa; color:#636e72; }
  </style>
  </head>
  <body>

  <div class="container">
      <div class="header">
          <h1>Relatório Diário de Obra - Usina Solar</h1>
          <div class="date">Data da análise: 03/12/2025</div>
      </div>

      <div class="kpi">
          <div class="kpicard" onclick="filtra('total')"><p>Total de Atividades</p><h2>257</h2></div>
          <div class="kpicard atrasadas" onclick="filtra('Atrasadas')"><p>Atrasadas</p><h2>2</h2></div>
          <div class="kpicard exec" onclick="filtra('Em execução')"><p>Em Execução</p><h2>3</h2></div>
          <div class="kpicard prox" onclick="filtra('Previstas (15 dias)')"><p>Próximos 15 dias</p><h2>1</h2></div>
          <div class="kpicard conc" onclick="filtra('Concluídas')"><p>Concluídas</p><h2>2</h2></div>
          <div class="kpicard" style="border-color:#8B4513" onclick="filtra('critica')"><p>Críticas</p><h2>5</h2></div>
      </div>

      <div class="charts">
          <canvas id="pizza"></canvas>
          <canvas id="linha"></canvas>
      </div>

      <div class="controls">
          <input type="text" id="busca" placeholder="Buscar por código ou nome..." onkeyup="buscar()">
          <button onclick="filtra('total')">Mostrar Todas</button>
      </div>

      <div class="atividades" id="lista"></div>
  </div>

  <div class="modal" id="modal">
      <div class="modal-content">
          <span class="close" onclick="document.getElementById('modal').style.display='none'">×</span>
          <h2 id="modalTitulo"></h2>
          <div id="modalCorpo"></div>
      </div>
  </div>

  <script>
  const atividades = "[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object]";
  const criticasList = "[object Object],[object Object],[object Object],[object Object],[object Object]";

  new Chart(document.getElementById('pizza'), {
      type: 'doughnut',
      data: { labels: ['Atrasadas','Em execução','Próximos 15 dias','Concluídas','Outras'],
          datasets: [{ data: [2,3,1,2,249],
              backgroundColor: ['#e74c3c','#3498db','#f39c12','#27ae60','#95a5a6'] }]
      },
      options: { plugins: { title: { display:true, text:'Distribuição por Status' } } }
  });

  new Chart(document.getElementById('linha'), {
      type: 'bar',
      data: { labels: ['Planejado','Executado','Restante'],
          datasets: [{ label: 'Valor (R$)', data: [0.0,0.0,0.0],
              backgroundColor: ['#3498db','#27ae60','#e74c3c'] }]
      },
      options: { plugins: { title: { display:true, text:'Progresso Financeiro' } } }
  });

  function render(lista) {
      const c = document.getElementById('lista');
      c.innerHTML = '';
      if (!lista.length) { c.innerHTML = '<p style="text-align:center;padding:80px;color:#95a5a6;font-size:1.2rem">Nenhuma atividade encontrada</p>'; return; }
      lista.forEach(a => {
          const classe = a.status_andamento === 'Atrasadas' ? 'atrasada' :
                         a.status_andamento === 'Em execução' ? 'exec' :
                         a.status_andamento === 'Previstas (15 dias)' ? 'prox' :
                         a.status_andamento === 'Concluídas' ? 'concluida' : '';
          const corBarra = a.status_andamento === 'Atrasadas' ? '#e74c3c' :
                           a.status_andamento === 'Concluídas' ? '#27ae60' : '#3498db';
          const div = document.createElement('div');
          div.className = `atividade ${classe}`;
          div.innerHTML = `
              <div class="atividade-header">
                  <div class="atividade-title">#${a.codigo} • ${a.nivel} • ${a.setor || '-'}</div>
                  <span class="badge" style="background:${a.status_andamento==='Atrasadas'?'#fee2e2':a.status_andamento==='Concluídas'?'#dcfce7':'#dbeafe'};color:${a.status_andamento==='Atrasadas'?'#991b1b':a.status_andamento==='Concluídas'?'#166534':'#1e40af'}">${a.status_andamento}</span>
              </div>
              <div style="font-size:1.3rem;font-weight:600;margin:10px 0">${a.atividade}${a.is_milestone ? ' (Milestone)' : ''}</div>
              <div style="color:#636e72;margin-bottom:10px">Planejado: ${a.inicio_planejado || '-'} → ${a.termino_planejado || '-'}</div>
              <div class="progress">
                  <div class="progress-bar" style="width:${a.pct_concluida}%;background:${corBarra}"></div>
                  <div class="progress-ideal" style="left:${a.pct_ideal_ate_hoje}%"></div>
              </div>
              <div style="text-align:right;font-size:0.9rem;color:#636e72">Real: ${a.pct_concluida}% | Ideal: ${a.pct_ideal_ate_hoje}%</div>`;
          div.onclick = () => openModal(a);
          c.appendChild(div);
      });
  }

  function openModal(a) {
      document.getElementById('modalTitulo').innerHTML = `#${a.codigo} - ${a.atividade}`;
      let html = `<p><strong>Nível:</strong> ${a.nivel}</p>
                  <p><strong>Status:</strong> ${a.status_andamento}</p>
                  <p><strong>Alerta:</strong> <span style="color:#8B4513;font-weight:600">${a.alerta_produtividade || 'Nenhum'}</span></p>`;
      if (a.predecessores && a.predecessores.length) {
          html += `<div style="margin-top:20px"><div class="deps-title">Predecessores</div>`;
          a.predecessores.forEach(p => {
              const cor = p.status === 'Concluídas' ? '#27ae60' : p.status === 'Atrasadas' ? '#e74c3c' : '#3498db';
              html += `<div class="dep-item ${p.status==='Atrasadas'?'atrasada':p.status==='Concluídas'?'concluida':''}" style="border-left-color:${cor}">#${p.item || '?'} - ${p.nome || 'Sem nome'}</div>`;
          });
          html += `</div>`;
      }
      if (a.sucessores && a.sucessores.length) {
          html += `<div style="margin-top:15px"><div class="deps-title">Sucessores</div>`;
          a.sucessores.forEach(s => {
              const cor = s.status === 'Concluídas' ? '#27ae60' : s.status === 'Atrasadas' ? '#e74c3c' : '#3498db';
              html += `<div class="dep-item ${s.status==='Atrasadas'?'atrasada':s.status==='Concluídas'?'concluida':''}" style="border-left-color:${cor}">#${s.item || '?'} - ${s.nome || 'Sem nome'}</div>`;
          });
          html += `</div>`;
      }
      document.getElementById('modalCorpo').innerHTML = html;
      document.getElementById('modal').style.display = 'flex';
  }

  function filtra(tipo) {
      if (tipo === 'total') render(atividades);
      else if (tipo === 'critica') render(criticasList);
      else render(atividades.filter(a => a.status_andamento === tipo));
  }

  function buscar() {
      const termo = document.getElementById('busca').value.toLowerCase();
      render(atividades.filter(a => 
          String(a.codigo || '').toLowerCase().includes(termo) || 
          String(a.atividade || '').toLowerCase().includes(termo)
      ));
  }

  render(atividades);
  </script>

  <footer>Gerado automaticamente via n8n — 03/12/2025</footer>
  </body>
  </html>