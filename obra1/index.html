<!DOCTYPE html>
  <html lang="pt-BR">
  <head>
      <meta charset="UTF-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <title>Dashboard de Acompanhamento de Projetos</title>
      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
      <script src="https://cdn.jsdelivr.net/npm/chart.js@3.7.1/dist/chart.min.js"></script>
      <style>
          /* Variáveis de Cores */
          :root {
              --color-primary: #1d4ed8;
              --color-secondary: #f59e0b;
              --color-success: #10b981;
              --color-danger: #ef4444;
              --color-warning: #f59e0b;
              --color-info: #8b5cf6;
              --color-default: #94a3b8;
              --color-background: #f9fafb;
              --color-card-bg: #ffffff;
              --color-text: #1f2937;
              --color-text-light: #6b7280;
              --color-border: #e5e7eb;
          }

          * {
              box-sizing: border-box;
              margin: 0;
              padding: 0;
              font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
          }

          body {
              background-color: var(--color-background);
              color: var(--color-text);
              padding: 20px;
          }

          .dashboard-container {
              max-width: 1400px;
              margin: 0 auto;
              display: grid;
              grid-template-columns: 1fr;
              gap: 20px;
          }

          .header {
              background-color: var(--color-card-bg);
              padding: 20px;
              border-radius: 8px;
              box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.1);
              border-left: 5px solid var(--color-primary);
          }

          .header h1 {
              font-size: 1.8rem;
              margin-bottom: 5px;
              color: var(--color-primary);
          }

          .header p {
              font-size: 0.9rem;
              color: var(--color-text-light);
          }

          .summary-cards {
              display: grid;
              grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
              gap: 20px;
          }

          .card {
              background-color: var(--color-card-bg);
              padding: 20px;
              border-radius: 8px;
              box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.1);
              border-left: 4px solid var(--color-border);
              transition: all 0.3s ease;
          }

          .card:hover {
              transform: translateY(-2px);
              box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -4px rgba(0, 0, 0, 0.1);
          }

          .card-title {
              font-size: 0.9rem;
              color: var(--color-text-light);
              margin-bottom: 5px;
              display: flex;
              align-items: center;
          }

          .card-title i {
              margin-right: 8px;
          }

          .card-value {
              font-size: 1.8rem;
              font-weight: 600;
              color: var(--color-text);
          }

          .card-subtitle {
              font-size: 0.8rem;
              color: var(--color-text-light);
              margin-top: 5px;
          }

          .card.total { border-left-color: var(--color-primary); }
          .card.concluida { border-left-color: var(--color-success); }
          .card.atrasadas { border-left-color: var(--color-danger); }
          .card.execucao { border-left-color: var(--color-info); }
          .card.financeiro { border-left-color: var(--color-secondary); }

          .charts-alerts {
              display: grid;
              grid-template-columns: 2fr 1fr;
              gap: 20px;
          }

          .chart-card {
              background-color: var(--color-card-bg);
              padding: 20px;
              border-radius: 8px;
              box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.1);
          }

          .chart-card h2 {
              font-size: 1.2rem;
              margin-bottom: 15px;
              border-bottom: 1px solid var(--color-border);
              padding-bottom: 10px;
          }

          .alerts-card {
              background-color: var(--color-card-bg);
              padding: 20px;
              border-radius: 8px;
              box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.1);
              max-height: 500px;
              overflow-y: auto;
          }

          .alerts-card h2 {
              font-size: 1.2rem;
              margin-bottom: 15px;
              border-bottom: 1px solid var(--color-border);
              padding-bottom: 10px;
              color: var(--color-danger);
          }

          .alert-item {
              padding: 10px 0;
              border-bottom: 1px dashed var(--color-border);
              cursor: pointer;
              transition: background-color 0.2s;
          }

          .alert-item:hover {
              background-color: #f3f4f6;
          }

          .alert-item-title {
              font-weight: 600;
              font-size: 0.9rem;
              color: var(--color-text);
          }

          .alert-item-meta {
              font-size: 0.8rem;
              color: var(--color-text-light);
              margin-top: 3px;
          }

          .tabs-container {
              background-color: var(--color-card-bg);
              padding: 20px;
              border-radius: 8px;
              box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.1);
          }

          .tabs-header {
              display: flex;
              border-bottom: 2px solid var(--color-border);
              margin-bottom: 15px;
              overflow-x: auto;
          }

          .tab-button {
              padding: 10px 15px;
              cursor: pointer;
              font-weight: 600;
              color: var(--color-text-light);
              border: none;
              background: none;
              border-bottom: 3px solid transparent;
              transition: all 0.3s ease;
              white-space: nowrap;
          }

          .tab-button.active {
              color: var(--color-primary);
              border-bottom-color: var(--color-primary);
          }

          .tab-content {
              display: none;
          }

          .tab-content.active {
              display: block;
          }

          .activity-table {
              width: 100%;
              border-collapse: collapse;
              font-size: 0.9rem;
          }

          .activity-table th, .activity-table td {
              padding: 12px 15px;
              text-align: left;
              border-bottom: 1px solid var(--color-border);
          }

          .activity-table th {
              background-color: #f3f4f6;
              font-weight: 600;
              color: var(--color-text);
              position: sticky;
              top: 0;
              z-index: 10;
          }

          .activity-table tbody tr:hover {
              background-color: #f9fafb;
              cursor: pointer;
          }

          .badge {
              display: inline-block;
              padding: 4px 8px;
              border-radius: 4px;
              font-size: 0.75rem;
              font-weight: 600;
              text-transform: uppercase;
              white-space: nowrap;
          }

          .badge-concluida { background-color: #d1fae5; color: var(--color-success); }
          .badge-atrasada { background-color: #fee2e2; color: var(--color-danger); }
          .badge-execucao { background-color: #ede9fe; color: var(--color-info); }
          .badge-prevista { background-color: #fffbeb; color: var(--color-warning); }
          .badge-planejada { background-color: #e2e8f0; color: var(--color-default); }
          .badge-default { background-color: #f3f4f6; color: var(--color-text-light); }

          .badge-prod-ok { background-color: #d1fae5; color: var(--color-success); }
          .badge-prod-alerta { background-color: #fee2e2; color: var(--color-danger); }
          .badge-prod-default { background-color: #e2e8f0; color: var(--color-text-light); }

          .sidebar {
              position: fixed;
              top: 0;
              right: 0;
              width: 350px;
              height: 100%;
              background-color: var(--color-card-bg);
              box-shadow: -4px 0 10px rgba(0, 0, 0, 0.1);
              transform: translateX(100%);
              transition: transform 0.3s ease-in-out;
              z-index: 100;
              display: flex;
              flex-direction: column;
          }

          .sidebar.open {
              transform: translateX(0);
          }

          .sidebar-header {
              padding: 15px 20px;
              color: white;
              display: flex;
              justify-content: space-between;
              align-items: center;
              border-bottom: 1px solid rgba(255, 255, 255, 0.2);
          }

          .sidebar-header h3 {
              font-size: 1.2rem;
              margin: 0;
          }

          .sidebar-close {
              background: none;
              border: none;
              color: white;
              font-size: 1.5rem;
              cursor: pointer;
          }

          .sidebar-content {
              padding: 20px;
              overflow-y: auto;
              flex-grow: 1;
          }

          .sidebar-section {
              margin-bottom: 20px;
              padding-bottom: 15px;
              border-bottom: 1px solid var(--color-border);
          }

          .sidebar-section h4 {
              font-size: 1rem;
              color: var(--color-primary);
              margin-bottom: 10px;
              display: flex;
              align-items: center;
          }

          .sidebar-section h4 i {
              margin-right: 8px;
          }

          .progress-bar-container {
              background-color: #e5e7eb;
              border-radius: 4px;
              height: 8px;
              margin-top: 5px;
              overflow: hidden;
          }

          .progress-bar {
              height: 100%;
              background-color: var(--color-success);
              transition: width 0.5s ease;
          }

          @media (min-width: 768px) {
              .dashboard-container {
                  grid-template-columns: 1fr;
              }
          }

          @media (min-width: 1024px) {
              .charts-alerts {
                  grid-template-columns: 3fr 1fr;
              }
          }
      </style>
  </head>
  <body>

  <div class="dashboard-container">

      <!-- Cabeçalho -->
      <div class="header">
          <h1>Acompanhamento de Projetos</h1>
          <p>Dados atualizados em: 09/12/2025</p>
      </div>

      <!-- Cards de Resumo -->
      <div class="summary-cards">

          <div class="card total">
              <div class="card-title"><i class="fas fa-tasks"></i> Total de Atividades</div>
              <div class="card-value">0</div>
              <div class="card-subtitle">0% do total</div>
          </div>

          <div class="card concluida">
              <div class="card-title"><i class="fas fa-check-circle"></i> Concluídas</div>
              <div class="card-value">0</div>
              <div class="card-subtitle">0% do total</div>
          </div>

          <div class="card atrasadas">
              <div class="card-title"><i class="fas fa-exclamation-triangle"></i> Atrasadas</div>
              <div class="card-value">0</div>
              <div class="card-subtitle">Atividades com término planejado perdido</div>
          </div>

          <div class="card execucao">
              <div class="card-title"><i class="fas fa-running"></i> Em Execução</div>
              <div class="card-value">0</div>
              <div class="card-subtitle">Atividades com início real</div>
          </div>

          <div class="card financeiro">
              <div class="card-title"><i class="fas fa-dollar-sign"></i> Progresso Financeiro</div>
              <div class="card-value">0.0%</div>
              <div class="card-subtitle">Executado: R$ 0,00 / Planejado: R$ 0,00</div>
          </div>

      </div>

      <!-- Gráficos e Alertas -->
      <div class="charts-alerts">

          <!-- Gráfico de Status de Andamento -->
          <div class="chart-card">
              <h2>Status de Andamento das Atividades</h2>
              <canvas id="statusChart" height="150"></canvas>
          </div>

          <!-- Alertas de Produtividade -->
          <div class="alerts-card">
              <h2><i class="fas fa-bell"></i> Alertas Críticos (0)</h2>
  <p class="card-subtitle" style="text-align: center; margin-top: 10px;">Nenhum alerta crítico encontrado.</p>
          </div>
      </div>

      <!-- Tabs de Atividades -->
      <div class="tabs-container">
          <h2>Detalhes das Atividades (Nível 3+)</h2>
          <div class="tabs-header">
  
          <button class="tab-button active" data-tab="Atrasadas">
              Atrasadas (0)
          </button>
      
          <button class="tab-button " data-tab="Em_execução">
              Em execução (0)
          </button>
      
          <button class="tab-button " data-tab="Previstas_(15_dias)">
              Previstas (15 dias) (0)
          </button>
      
          <button class="tab-button " data-tab="Concluídas">
              Concluídas (0)
          </button>
      
          <button class="tab-button " data-tab="Planejadas">
              Planejadas (0)
          </button>
      
          </div>
          <div class="tabs-content">
  
          <div id="Atrasadas" class="tab-content active">
              <div style="max-height: 500px; overflow-y: auto;">
                  <table class="activity-table">
                      <thead>
                          <tr>
                              <th>Código</th>
                              <th>Atividade</th>
                              <th>Setor</th>
                              <th>% Plan.</th>
                              <th>% Real</th>
                              <th>% Ideal</th>
                              <th>Alerta</th>
                              <th>Status</th>
                          </tr>
                      </thead>
                      <tbody>
      
                      </tbody>
                  </table>
              </div>
          </div>
      
          <div id="Em_execução" class="tab-content ">
              <div style="max-height: 500px; overflow-y: auto;">
                  <table class="activity-table">
                      <thead>
                          <tr>
                              <th>Código</th>
                              <th>Atividade</th>
                              <th>Setor</th>
                              <th>% Plan.</th>
                              <th>% Real</th>
                              <th>% Ideal</th>
                              <th>Alerta</th>
                              <th>Status</th>
                          </tr>
                      </thead>
                      <tbody>
      
                      </tbody>
                  </table>
              </div>
          </div>
      
          <div id="Previstas_(15_dias)" class="tab-content ">
              <div style="max-height: 500px; overflow-y: auto;">
                  <table class="activity-table">
                      <thead>
                          <tr>
                              <th>Código</th>
                              <th>Atividade</th>
                              <th>Setor</th>
                              <th>% Plan.</th>
                              <th>% Real</th>
                              <th>% Ideal</th>
                              <th>Alerta</th>
                              <th>Status</th>
                          </tr>
                      </thead>
                      <tbody>
      
                      </tbody>
                  </table>
              </div>
          </div>
      
          <div id="Concluídas" class="tab-content ">
              <div style="max-height: 500px; overflow-y: auto;">
                  <table class="activity-table">
                      <thead>
                          <tr>
                              <th>Código</th>
                              <th>Atividade</th>
                              <th>Setor</th>
                              <th>% Plan.</th>
                              <th>% Real</th>
                              <th>% Ideal</th>
                              <th>Alerta</th>
                              <th>Status</th>
                          </tr>
                      </thead>
                      <tbody>
      
                      </tbody>
                  </table>
              </div>
          </div>
      
          <div id="Planejadas" class="tab-content ">
              <div style="max-height: 500px; overflow-y: auto;">
                  <table class="activity-table">
                      <thead>
                          <tr>
                              <th>Código</th>
                              <th>Atividade</th>
                              <th>Setor</th>
                              <th>% Plan.</th>
                              <th>% Real</th>
                              <th>% Ideal</th>
                              <th>Alerta</th>
                              <th>Status</th>
                          </tr>
                      </thead>
                      <tbody>
      
                      </tbody>
                  </table>
              </div>
          </div>
      
          </div>
      </div>

  </div>

  <!-- Sidebar de Detalhes -->
  <div id="sidebar" class="sidebar">
      <div id="sidebar-header" class="sidebar-header" style="background-color: var(--color-primary);">
          <h3 id="sidebar-title">Detalhes da Atividade</h3>
          <button class="sidebar-close" onclick="closeSidebar()">&times;</button>
      </div>
      <div id="sidebar-content" class="sidebar-content">
          <!-- Conteúdo preenchido pelo JavaScript -->
      </div>
  </div>

  <script>
      // Dados para o JavaScript
      const atividadesData = [];
      const atividadesLabels = [];
      const atividadesValues = [];

      // Função para abrir a sidebar
      function openSidebar(atividadeJson) {
          try {
              const atividade = JSON.parse(atividadeJson);
              const sidebar = document.getElementById('sidebar');
              const content = document.getElementById('sidebar-content');
              const header = document.getElementById('sidebar-header');

              // Determinar cor do cabeçalho
              let headerColor = '#1d4ed8';
              if (atividade.status_andamento) {
                  if (atividade.status_andamento.includes("Concluídas")) headerColor = "#10b981";
                  else if (atividade.status_andamento.includes("Atrasadas")) headerColor = "#ef4444";
                  else if (atividade.status_andamento.includes("execução")) headerColor = "#8b5cf6";
                  else if (atividade.status_andamento.includes("Previstas")) headerColor = "#f59e0b";
                  else if (atividade.status_andamento.includes("Planejadas")) headerColor = "#94a3b8";
              }
              header.style.backgroundColor = headerColor;

              // Título
              document.getElementById('sidebar-title').innerText = `#${atividade.codigo || ''} - ${atividade.atividade || ''}`;

              // Conteúdo da sidebar
              content.innerHTML = `
                  <div class="sidebar-section sidebar-meta">
                      <h4><i class="fas fa-info-circle"></i> Informações Gerais</h4>
                      <p>Nível: <span>${atividade.nivel || '-'}</span></p>
                      <p>Setor: <span>${atividade.setor || '-'}</span></p>
                      <p>Milestone: <span>${atividade.is_milestone ? 'Sim' : 'Não'}</span></p>
                      <p>Status Andamento: <span class="badge">${atividade.status_andamento || '-'}</span></p>
                  </div>

                  <div class="sidebar-section sidebar-meta">
                      <h4><i class="fas fa-calendar-alt"></i> Datas</h4>
                      <p>Início Planejado: <span>${atividade.inicio_planejado || '-'}</span></p>
                      <p>Término Planejado: <span>${atividade.termino_planejado || '-'}</span></p>
                      <p>Início Real: <span>${atividade.inicio_real || '-'}</span></p>
                      <p>Término Real: <span>${atividade.termino_real || '-'}</span></p>
                  </div>

                  <div class="sidebar-section">
                      <h4><i class="fas fa-chart-line"></i> Progresso</h4>
                      <p>% Planejada: <span>${atividade.pct_planejada || 0}%</span></p>
                      <p>% Concluída: <span>${atividade.pct_concluida || 0}%</span></p>
                      <p>% Ideal (Curva S): <span>${atividade.pct_ideal_ate_hoje || 0}%</span></p>
                      <div class="progress-bar-container">
                          <div class="progress-bar" style="width: ${atividade.pct_concluida || 0}%;"></div>
                      </div>
                      <p style="margin-top: 10px;">Alerta: <span class="badge">${atividade.alerta_produtividade || '-'}</span></p>
                  </div>

                  <div class="sidebar-section sidebar-meta">
                      <h4><i class="fas fa-money-bill-wave"></i> Financeiro</h4>
                      <p>Peso Financeiro: <span>${atividade.peso_financeiro_pct || 0}%</span></p>
                      <p>R$ Planejamento: <span>${atividade.r_planejamento || '-'}</span></p>
                      <p>R$ Executado: <span>${atividade.r_real_executado || '-'}</span></p>
                      <p>R$ Restante: <span>${atividade.r_restante || '-'}</span></p>
                  </div>
              `;

              sidebar.classList.add('open');
          } catch (error) {
              console.error('Erro ao abrir sidebar:', error);
          }
      }

      // Função para fechar a sidebar
      function closeSidebar() {
          document.getElementById('sidebar').classList.remove('open');
      }

      // Função para alternar as tabs
      function setupTabs() {
          const tabs = document.querySelectorAll('.tab-button');
          const contents = document.querySelectorAll('.tab-content');

          tabs.forEach(tab => {
              tab.addEventListener('click', () => {
                  tabs.forEach(t => t.classList.remove('active'));
                  contents.forEach(c => c.classList.remove('active'));

                  tab.classList.add('active');
                  const targetId = tab.getAttribute('data-tab');
                  document.getElementById(targetId).classList.add('active');
              });
          });
      }

      // Inicialização do gráfico
      function initCharts() {
          if (typeof Chart === 'undefined') {
              console.warn('Chart.js não carregado');
              return;
          }

          try {
              const ctx = document.getElementById('statusChart');
              if (ctx && atividadesLabels.length > 0) {
                  new Chart(ctx, {
                      type: 'doughnut',
                      data: {
                          labels: atividadesLabels,
                          datasets: [{
                              data: atividadesValues,
                              backgroundColor: [
                                  '#ef4444',
                                  '#8b5cf6',
                                  '#f59e0b',
                                  '#10b981',
                                  '#94a3b8'
                              ]
                          }]
                      },
                      options: {
                          responsive: true,
                          maintainAspectRatio: false
                      }
                  });
              }
          } catch (error) {
              console.error('Erro ao criar gráfico:', error);
          }
      }

      // Inicialização
      document.addEventListener('DOMContentLoaded', () => {
          setupTabs();
          initCharts();
      });
  </script>

  </body>
  </html>
  